<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº”è¡Œãƒãƒ©ãƒ³ã‚¹å ã„</title>
  <style>
    body { font-family: sans-serif; background-color: #f4f4fc; padding: 20px; }
    h1 { color: #3949ab; }
    .box { background: #fff; border-radius: 10px; border: 2px solid #3949ab; padding: 20px; max-width: 700px; }
    .highlight { color: #e53935; font-weight: bold; }
    .element { font-weight: bold; color: #1e88e5; }
    .advice { margin-top: 10px; }
    canvas { margin-top: 20px; background-color: #fff; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>ğŸŒ ä»Šæ—¥ã®äº”è¡Œãƒãƒ©ãƒ³ã‚¹å ã„</h1>
  <div class="box" id="output">
    <p>ä½ç½®æƒ…å ±ã¨å¤©æ°—ã‚’èª­ã¿å–ã£ã¦ã„ã¾ã™...</p>
  </div>
  <canvas id="pentagonChart" width="300" height="300"></canvas>

  <script>
    const OPENWEATHER_API_KEY = "KEY";//APIã‚­ãƒ¼ã‚’ã“ã“ã«å…¥åŠ›

    const fiveElementMap = {
      "æ™´ã‚Œ": { boost: {"ç«": 2, "æ°´": -1} },
      "æ›‡ã‚Š": { boost: {"åœŸ": 1, "æœ¨": -1} },
      "é›¨": { boost: {"æ°´": 2, "ç«": -1, "åœŸ": -1} },
      "é¢¨": { boost: {"æœ¨": 2, "é‡‘": -1} },
      "é›ª": { boost: {"é‡‘": 2, "æœ¨": -1} }
    };

    const fiveElementAdvice = {
      "æœ¨": "ğŸŒ³ æœ¨ãŒä¸è¶³ â†’ ç·‘ã®é‡èœã‚’é£Ÿã¹ã‚‹ï¼æ£®æ—æµ´ãŒãŠã™ã™ã‚",
      "ç«": "ğŸ”¥ ç«ãŒä¸è¶³ â†’ èµ¤ã„æœã‚’ç€ã‚‹ï¼ä½“ã‚’æ¸©ã‚ã‚‹è¡Œå‹•ã‚’",
      "åœŸ": "â›° åœŸãŒä¸è¶³ â†’ é»„è‰²ç³»ã®é£Ÿäº‹ï¼ˆã•ã¤ã¾ã„ã‚‚ãªã©ï¼‰ã‚’ã¨ã‚‹",
      "é‡‘": "âšª é‡‘ãŒä¸è¶³ â†’ é‡‘å±è£½ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ï¼é¦™ã‚Šã‚’å¤§åˆ‡ã«",
      "æ°´": "ğŸ’§ æ°´ãŒä¸è¶³ â†’ æ¹¯èˆ¹ã«ã¤ã‹ã‚‹ï¼é»’ã„ã‚¢ã‚¤ãƒ†ãƒ ãŒå‰"
    };

    function getGeoLocation() {
      navigator.geolocation.getCurrentPosition(success, error);
    }

    function success(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_API_KEY}&lang=ja`)
        .then(res => res.json())
        .then(data => {
          const weather = data.weather[0].main;
          const city = data.name;
          const simplifiedWeather = convertWeather(weather);
          const baseScore = {"æœ¨": 3, "ç«": 3, "åœŸ": 3, "é‡‘": 3, "æ°´": 3};
          const boost = fiveElementMap[simplifiedWeather]?.boost || {};

          for (const key in boost) {
            baseScore[key] = Math.max(0, Math.min(5, baseScore[key] + boost[key]));
          }

          const lacking = Object.entries(baseScore).filter(([_, score]) => score <= 2).map(([el]) => el);
          let lackingAdvice = lacking.map(el => `<li>${fiveElementAdvice[el]}</li>`).join("");

          document.getElementById("output").innerHTML = `
            <p>ğŸ“ã‚¨ãƒªã‚¢ï¼š<strong>${city}</strong></p>
            <p>â˜ï¸ å¤©æ°—ï¼š<strong>${simplifiedWeather}</strong></p>
            <p class="highlight">ğŸ”® äº”è¡Œãƒãƒ©ãƒ³ã‚¹ãƒãƒ£ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼</p>
            <div class="advice">
              <p>âš– ä¸è¶³ã—ã¦ã„ã‚‹äº”è¡Œã¨è£œã†æ–¹æ³•ï¼š</p>
              <ul>${lackingAdvice}</ul>
            </div>
          `;

          drawPentagonChart(baseScore);
        });
    }

    function error(err) {
      document.getElementById("output").innerHTML = `<p>ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚${err.message}</p>`;
    }

    function convertWeather(raw) {
      if (raw.includes("Clear")) return "æ™´ã‚Œ";
      if (raw.includes("Clouds")) return "æ›‡ã‚Š";
      if (raw.includes("Rain") || raw.includes("Drizzle")) return "é›¨";
      if (raw.includes("Snow")) return "é›ª";
      if (raw.includes("Wind")) return "é¢¨";
      return "ä¸æ˜";
    }

    function drawPentagonChart(scores) {
      const canvas = document.getElementById("pentagonChart");
      const ctx = canvas.getContext("2d");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const maxRadius = 100;
      const elements = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // å¤–æ ã®äº”è§’å½¢
      ctx.beginPath();
      for (let i = 0; i < 5; i++) {
        const angle = (Math.PI * 2 / 5) * i - Math.PI / 2;
        const x = centerX + maxRadius * Math.cos(angle);
        const y = centerY + maxRadius * Math.sin(angle);
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.strokeStyle = "#3949ab";
      ctx.stroke();

      // ãƒ©ãƒ™ãƒ«
      for (let i = 0; i < 5; i++) {
        const angle = (Math.PI * 2 / 5) * i - Math.PI / 2;
        const x = centerX + (maxRadius + 15) * Math.cos(angle);
        const y = centerY + (maxRadius + 15) * Math.sin(angle);
        ctx.fillStyle = "#3949ab";
        ctx.fillText(elements[i], x - 10, y);
      }

      // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
      ctx.beginPath();
      for (let i = 0; i < 5; i++) {
        const value = scores[elements[i]] / 5;
        const angle = (Math.PI * 2 / 5) * i - Math.PI / 2;
        const x = centerX + maxRadius * value * Math.cos(angle);
        const y = centerY + maxRadius * value * Math.sin(angle);
        ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fillStyle = "rgba(57, 73, 171, 0.3)";
      ctx.fill();
      ctx.strokeStyle = "#1e88e5";
      ctx.stroke();
    }

    getGeoLocation();
  </script>
</body>
</html>

